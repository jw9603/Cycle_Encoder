# 5월 30일

내일 미팅이므로 일단 진행했던거 그대로 진행해본다.

0.0497, 0.0399, 0.0433, 0.0482

일단 9-32의 alpha값을 뽑아야한다. 

edge_index파악하기 torch.Size([2, 156]) [0:156]
edge_index파악하기 torch.Size([2, 198]) [156:354]
edge_index파악하기 torch.Size([2, 368])
edge_index파악하기 torch.Size([2, 238])

사이클에 해당하는 edge_type triple 및 alpha1, alpha5출력 코드

```python
# 평균값고 평균값의 최댓값
import torch
from itertools import product

num_heads = 4

def find_edge_combinations(node_list):
    edge_combinations = []
    for i in range(len(node_list)):
        current_edges = []
        for j in range(edge_index.shape[1]):
            if edge_index[0, j] == node_list[i] and edge_index[1, j] == node_list[(i + 1) % len(node_list)]:
                current_edges.append((edge_index[0, j].item(), edge_index[1, j].item(), edge_type[j].item()))
        edge_combinations.append(current_edges)
    return list(product(*edge_combinations))

def is_cycle(edge_indices, node_list):
    nodes_visited = set()
    for edge in edge_indices:
        nodes_visited.add(edge[0])
        nodes_visited.add(edge[1])
    return nodes_visited == set(node_list)

def find_edges(node_list):
    edge_combinations = find_edge_combinations(node_list)
    valid_cycles = []
    for combination in edge_combinations:
        edge_indices = [(edge[0], edge[1]) for edge in combination]
        edge_types = [edge[2] for edge in combination]
        if len(set(edge_indices)) == len(node_list) and is_cycle(edge_indices, node_list):
            valid_cycles.append((edge_indices, edge_types))
    return valid_cycles

def count_duplicates(lst):
    return len(lst) - len(set(lst))
max_alpha1_values = torch.zeros(num_heads)
max_alpha5_values = torch.zeros(num_heads)
max_info_alpha1 = [None] * num_heads
max_info_alpha5 = [None] * num_heads

# for item in a25:
#     node_list = item[25]
#     valid_cycles = find_edges(node_list)

#     print(f"{node_list}'s Number of cycles : {len(valid_cycles)}")

#     for edge_indices, edge_types in valid_cycles:
#         sum_alpha_values1 = []
#         sum_alpha_values5 = []
#         for idx, edge_type_value in enumerate(edge_types):
#             sum_alpha1 = torch.sum(alpha1[edge_type_value, :])
#             sum_alpha5 = torch.sum(alpha5[edge_type_value, :])
#             sum_alpha_values1.append(sum_alpha1.item())
#             sum_alpha_values5.append(sum_alpha5.item())

#         avg_alpha1 = [sum_alpha / num_heads for sum_alpha in sum_alpha_values1]
#         avg_alpha5 = [sum_alpha / num_heads for sum_alpha in sum_alpha_values5]

#         print(f"Node List: {node_list}")
#         print(f"Edge Indices: {edge_indices}")
#         print(f"Edge Types: {edge_types}")
#         print(f"Triple Form: {list(zip(edge_indices, edge_types))}")
#         print(f"Average Alpha1: {[f'{value:.4f}' for value in avg_alpha1]}")
#         print(f"Average Alpha5: {[f'{value:.4f}' for value in avg_alpha5]}\n")

avg_alpha1_values = []
avg_alpha5_values = []

for item in a25:
    node_list = item[25]
    valid_cycles = find_edges(node_list)

    print(f"{node_list}'s Number of cycles : {len(valid_cycles)}")

    for edge_indices, edge_types in valid_cycles:
        sum_alpha_values1 = []
        sum_alpha_values5 = []
        for idx, edge_type_value in enumerate(edge_types):
            sum_alpha1 = torch.sum(alpha1[edge_type_value, :])
            sum_alpha5 = torch.sum(alpha5[edge_type_value, :])
            sum_alpha_values1.append(sum_alpha1.item())
            sum_alpha_values5.append(sum_alpha5.item())

        avg_alpha1 = [sum_alpha / num_heads for sum_alpha in sum_alpha_values1]
        avg_alpha5 = [sum_alpha / num_heads for sum_alpha in sum_alpha_values5]

        avg_alpha1_value = sum(avg_alpha1) / len(avg_alpha1)
        avg_alpha5_value = sum(avg_alpha5) / len(avg_alpha5)

        avg_alpha1_values.append((node_list, avg_alpha1_value, edge_types))
        avg_alpha5_values.append((node_list, avg_alpha5_value, edge_types))

        print(f"Node List: {node_list}")
        print(f"Edge Indices: {edge_indices}")
        print(f"Edge Types: {edge_types}")
        print(f"Triple Form: {list(zip(edge_indices, edge_types))}")
        print(f"Average Alpha1: {[f'{value:.4f}' for value in avg_alpha1]}")
        print(f"Average Alpha5: {[f'{value:.4f}' for value in avg_alpha5]}\n")

# Sort the lists by average values in descending order
avg_alpha1_values.sort(key=lambda x: x[1], reverse=True)
avg_alpha5_values.sort(key=lambda x: x[1], reverse=True)

# Print the top 10 node_list values with the largest average Alpha1 and Alpha5
print("Top 10 node_list values with the largest average Alpha1:")
for i in range(min(10, len(avg_alpha1_values))):
    print(f"{i + 1}. Node list: {avg_alpha1_values[i][0]}, Average Alpha1: {avg_alpha1_values[i][1]:.4f}, Edge Types: {avg_alpha1_values[i][2]}")

print("\nTop 10 node_list values with the largest average Alpha5:")
for i in range(min(10, len(avg_alpha5_values))):
    print(f"{i + 1}. Node list: {avg_alpha5_values[i][0]}, Average Alpha5: {avg_alpha5_values[i][1]:.4f}, Edge Types: {avg_alpha5_values[i][2]}")
```